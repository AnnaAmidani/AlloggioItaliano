package anna.alit.mock;

import java.io.InputStream;

import junit.framework.TestCase;

import org.apache.log4j.Logger;
//import org.tuckey.web.*;
//import org.tuckey.web.filters.urlrewrite.test.MockRequest;
//import org.tuckey.web.filters.urlrewrite.test.MockResponse;
//import org.tuckey.web.filters.urlrewrite.Conf;
//import org.tuckey.web.filters.urlrewrite.RewrittenUrl;
//import org.tuckey.web.filters.urlrewrite.UrlRewriter;
//import org.tuckey.web.filters.urlrewrite.utils.Log;

/**
 * Simple test case to determine if the rewrite configuration works as
 * expected.
 */
public class UrlRewriteConfigurationTest extends TestCase {

    private static final Logger log = Logger.getLogger(UrlRewriteConfigurationTest.class);
    private static final String REWRITE_CONF = "urlrewrite.xml";

//    private Conf conf;

    /**
     * Setup the UrlRewriteFilter configuration.
     */
    protected void setUp() {
//        Log.setLevel("DEBUG"); // to make the RewriteFilter code log messages
//        InputStream istream = getClass().getResourceAsStream("/" + REWRITE_CONF);
//        conf = new Conf(istream, REWRITE_CONF);
    }

    public void testRewrite1() throws Exception {
//        String fromUrl = "/d/foo/bar1/show.jsp?id=321456";
//        String toUrl = "/shownew.html?type=bar1&fooId=321456";
//        assertRewriteSuccess(fromUrl, toUrl, conf);
    }

    public void testRewrite2() throws Exception {
//        String fromUrl = "/d/foo/bar2/show.jsp?id=321456";
//        String toUrl = "/shownew.html?type=bar2&fooId=321456";
//        assertRewriteSuccess(fromUrl, toUrl, conf);
    }

    /**
     * Assertion to rewrite the URL using the UrlRewriteFilter and verify
     * that fromUrl is rewritten to toUrl using rewriting rules in conf.
     * @param fromUrl the URL to be rewritten from.
     * @param toUrl the URL to be rewritten to.
     * @param conf the UrlRewriteFilter configuration.
     * @throws Exception if one is thrown.
     */
//    private void assertRewriteSuccess(String fromUrl, String toUrl, Conf conf) throws Exception {
//        UrlRewriter rewriter = new UrlRewriter(conf);
//        MockRequest request = new MockRequest(fromUrl);
//        MockResponse response = new MockResponse();
//        RewrittenUrl rewrittenUrl = rewriter.processRequest(request, response);
//        assertNotNull("Could not rewrite URL from:" + fromUrl + " to:" + toUrl, rewrittenUrl);
//        String rewrittenUrlString = rewrittenUrl.getTarget();
//        log.debug("URL Rewrite from:[" + fromUrl + "] to [" + rewrittenUrlString + "]");
//        assertEquals("Rewrite from:" + fromUrl + " to:" + toUrl + " did not succeed", toUrl, rewrittenUrlString);
//    }
}
